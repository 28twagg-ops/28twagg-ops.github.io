<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CAKED UP CATS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;800;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --text:#eaffef;
      --muted:#bde7c8;
      --bg1:#061009;
      --bg2:#071a0c;
      --card: rgba(10, 40, 18, .72);
      --card2: rgba(10, 40, 18, .52);
      --stroke: rgba(120,255,170,.18);
      --accent:#4ade80;
      --accent2:#22c55e;
      --shadow: 0 14px 40px rgba(0,0,0,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--text);
      font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 520px at 15% 10%, rgba(74,222,128,.16), transparent 60%),
        radial-gradient(900px 520px at 85% 25%, rgba(34,197,94,.12), transparent 60%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 100%);
      overflow:hidden; /* desktop: no page scroll; panels scroll */
      color-scheme:dark;
    }

    .topbar{
      width:min(1300px, 94vw);
      margin:14px auto 10px;
      display:flex; align-items:center; justify-content:space-between;
      gap:12px;
    }
    .btn{
      height:38px; padding:0 12px;
      border-radius:12px;
      background:rgba(20,70,32,.45);
      border:1px solid var(--stroke);
      color:var(--text);
      font-weight:900;
      letter-spacing:.3px;
      cursor:pointer;
      display:inline-flex; align-items:center; justify-content:center;
      text-decoration:none;
      user-select:none;
    }
    .btn:hover{background:rgba(20,70,32,.62)}

    .badge{
      height:38px;
      padding:0 14px;
      border-radius:999px;
      border:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(74,222,128,.22), rgba(34,197,94,.10));
      display:flex; align-items:center; gap:10px;
      box-shadow: 0 10px 26px rgba(0,0,0,.30);
    }
    .badge .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px rgba(74,222,128,.7)}
    .badge .sub{color:var(--muted);font-weight:800;font-size:12px;letter-spacing:.4px}
    .badge .ini{font-weight:900}

    .layout{
      width:min(1300px, 94vw);
      margin:0 auto 18px;
      display:grid;
      grid-template-columns: 320px 1fr 320px;
      gap:12px;
      height: calc(100vh - 14px - 10px - 38px - 18px); /* topbar + margins */
      min-height: 560px;
    }
    .panel{
      background:linear-gradient(180deg,var(--card),var(--card2));
      border:1px solid var(--stroke);
      border-radius:18px;
      box-shadow:var(--shadow);
      padding:14px;
      min-height:0;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    .panel h3{margin:2px 0 10px;font-size:14px;letter-spacing:.9px;text-transform:uppercase;color:var(--muted)}
    .howto{
      border:1px dashed rgba(120,255,170,.22);
      border-radius:14px;
      padding:12px;
      background:rgba(0,0,0,.18);
    }
    .howto .row{display:flex;gap:10px;align-items:flex-start;margin:10px 0}
    .howto .ico{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;
      background:rgba(74,222,128,.18);border:1px solid rgba(120,255,170,.22);font-size:18px}
    .howto b{display:block}

    .gamepanel{min-height:0; display:flex; flex-direction:column; gap:10px}
    .gamebox{
      position:relative;
      border-radius:16px;
      overflow:hidden;
      border:1px solid rgba(120,255,170,.18);
      background:rgba(0,0,0,.20);
      min-height:0;
      height:min(72vh,640px);
      box-shadow: 0 0 24px rgba(74,222,128,.10);
    }
    iframe{
      width:100%; height:100%; border:0; display:block;
    }

    .lb{
      list-style:none; padding:0; margin:0;
      display:flex; flex-direction:column; gap:8px;
    }
    .lb li{
      display:flex; justify-content:space-between; align-items:center;
      padding:8px 10px;
      border-radius:12px;
      background:rgba(0,0,0,.22);
      border:1px solid rgba(120,255,170,.14);
      font-weight:800;
    }
    .lb .rank{color:var(--muted);width:30px}
    .lb .name{flex:1}
    .lb .score{font-variant-numeric:tabular-nums}

    .status{color:var(--muted);font-size:12px;margin:4px 0 8px}

    @media (max-width:1100px){
      html,body{height:auto;overflow:auto}
      body{overflow:auto}
      .layout{grid-template-columns:1fr; height:auto; min-height:0}
      .gamebox{height:min(62vh,520px)}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <a class="btn" href="../../index.html">‚úï EXIT</a>
    <div class="badge" title="Player">
      <span class="dot"></span>
      <span class="sub">PLAYER</span>
      <span class="ini" id="playInitials">???</span>
    </div>
  </div>

  <div class="layout">
    <aside class="panel">
      <h3>How to play</h3>
      <div class="howto">
        <div class="row"><div class="ico">üç∞</div><div><b>Eat Cake</b><span>Gain energy + short speed boost (+50 pts).</span></div></div>
        <div class="row"><div class="ico">üê≠</div><div><b>Catch the Mouse</b><span>Finish the level for a big bonus.</span></div></div>
        <div class="row"><div class="ico">üö´</div><div><b>Avoid Hazards</b><span>Dogs, mud slows you, sprinklers drain energy.</span></div></div>
        <div class="row"><div class="ico">‚å®Ô∏è</div><div><b>Controls</b><span>Arrow Keys / WASD. Mobile d‚Äëpad appears on touch devices.</span></div></div>
      </div>
    </aside>

    <main class="panel gamepanel">
      <h3>Caked Up Cats</h3>
      <div class="gamebox">
        <iframe id="gameFrame" src="game.html" title="Caked Up Cats"></iframe>
      </div>
      <div class="status" id="hint">Tip: swipe/press inside the game to control. Scroll works outside the game on mobile.</div>
    </main>

    <aside class="panel">
      <h3>Leaderboard</h3>
      <div class="status" id="lbStatus">Loading‚Ä¶</div>
      <ol class="lb" id="lbList"></ol>
    </aside>
  </div>

  <script src="../../js/engine.js"></script>
  <script>
    const GAME_SLUG = 'caked-up-cats';

    function getInitials(){
      const raw = localStorage.getItem('px_player_initials') || sessionStorage.getItem('px_player_initials') || localStorage.getItem('playerInitials') || '';
      const ini = (raw || '???').toUpperCase().replace(/[^A-Z0-9]/g,'').slice(0,3);
      return ini || '???';
    }

    async function refreshLeaderboard(){
      const status = document.getElementById('lbStatus');
      const list = document.getElementById('lbList');
      if (!status || !list || !window.PixelNet) return;

      status.textContent = 'Loading‚Ä¶';
      list.innerHTML = '';
      try{
        const data = await PixelNet.getLeaderboard(GAME_SLUG);
        const entries = (data && data.entries) ? data.entries : (Array.isArray(data) ? data : []);
        if (!entries.length){ status.textContent = 'No scores yet.'; return; }
        status.textContent = '';

        entries.slice(0,10).forEach((e, i)=>{
          const li = document.createElement('li');
          const initials = (e.initials || e.name || '---').toString().toUpperCase().slice(0,3);
          const score = Number(e.score ?? 0) || 0;
          li.innerHTML = `<span class="rank">${i+1}</span><span class="name">${initials}</span><span class="score">${score}</span>`;
          list.appendChild(li);
        });
      }catch(err){
        status.textContent = 'Leaderboard unavailable.';
        console.error(err);
      }
    }

    document.getElementById('playInitials').textContent = getInitials();
    refreshLeaderboard();
    setInterval(refreshLeaderboard, 8000);
  </script>
</body>
</html>
