<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Caked Up Cats</title>

  <!-- PIXEL-NET Engine -->
  <script src="../../js/engine.js"></script>

  <style>
    :root{
      --pn-bg:#07140a;
      --pn-panel: rgba(8, 25, 12, 0.78);
      --pn-border: rgba(255,255,255,0.10);
      --pn-accent:#4ade80;
      --pn-accent2:#fbbf24;
      --pn-muted:#b7d6c1;
    }

    body{
      margin:0;
      background: radial-gradient(900px 600px at 20% 10%, rgba(74, 222, 128, 0.20), transparent 60%),
                  radial-gradient(700px 500px at 85% 25%, rgba(251, 191, 36, 0.15), transparent 60%),
                  linear-gradient(180deg,#061108 0%,#040a05 100%);
      color:#eaffef;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      overflow:auto;
      touch-action: pan-y;
    }

    .play-shell{min-height:100vh;display:flex;flex-direction:column}

    .play-topbar{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:10px 12px;
      background: rgba(2, 10, 4, 0.75);
      border-bottom: 1px solid rgba(255,255,255,0.06);
      position:sticky;top:0;z-index:50;
      backdrop-filter: blur(8px);
    }

    .exit-btn{
      text-decoration:none;
      color: var(--pn-accent);
      border: 1px solid rgba(74,222,128,0.45);
      padding:6px 10px;
      border-radius:10px;
      box-shadow: 0 0 12px rgba(74,222,128,0.18);
      font-weight:800;
      letter-spacing:0.08em;
      font-size:12px;
      display:inline-flex;align-items:center;gap:6px;
    }

    .player-pill{
      display:inline-flex;align-items:center;gap:10px;
      padding:6px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(8, 25, 12, 0.60);
      font-weight:800;
      font-size:12px;
      letter-spacing:0.08em;
      white-space:nowrap;
    }
    .dot{width:8px;height:8px;border-radius:99px;background:var(--pn-accent);box-shadow:0 0 10px rgba(74,222,128,.55)}
    .player-pill .muted{color:var(--pn-muted);font-weight:700}
    .player-pill strong{color:var(--pn-accent)}

    .play-grid{
      flex:1 1 auto;
      display:grid;
      grid-template-columns: 300px 1fr 300px;
      gap:12px;
      padding:12px;
      box-sizing:border-box;
      align-items:stretch;
      min-height:0;
    }

    .panel{
      background: var(--pn-panel);
      border: 1px solid var(--pn-border);
      border-radius:14px;
      padding:12px;
      box-sizing:border-box;
      min-height:0;
      overflow:auto;
      box-shadow: 0 18px 50px rgba(0,0,0,0.35);
    }

    .panel h3{
      margin:0 0 10px 0;
      font-size:14px;
      letter-spacing:0.12em;
      color: var(--pn-accent2);
      text-transform:uppercase;
    }

    .howto{display:flex;flex-direction:column;gap:10px;font-size:12px;line-height:1.45;color:#d8f7e0}
    .howto .row{display:flex;gap:10px;align-items:flex-start}
    .ico{
      width:30px;height:30px;border-radius:10px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.22);
      display:grid;place-items:center;
      box-shadow: inset 0 0 0 1px rgba(74,222,128,0.10);
      flex:0 0 auto;
    }

    .game-panel{display:flex;flex-direction:column;gap:10px;min-height:0}
    .game-title{font-weight:900;letter-spacing:0.12em;text-transform:uppercase;color:var(--pn-accent)}

    .gamebox{
      position:relative;
      border-radius:16px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(0,0,0,0.30);
      min-height:0;
      flex: 1 1 auto;
    }

    /* NOTE: no on-page D-pad + no extra tip text; game is full-height inside this box */
    iframe{
      width:100%;height:100%;border:0;display:block;
      touch-action:none;
    }

    .lb-status{font-size:11px;color:var(--pn-muted);margin-bottom:8px}
    .lb-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .lb-col{list-style:none;margin:0;padding:0}
    .lb-item{
      display:flex;justify-content:space-between;gap:10px;
      padding:6px 8px;border-radius:12px;
      border:1px solid rgba(255,255,255,0.10);
      background: rgba(0,0,0,0.18);
      font-size:12px;
      font-weight:800;
    }

    @media (max-width: 980px){
      .play-grid{grid-template-columns:1fr}
      .panel{order:0}
      .gamebox{height:min(72vh,720px)}
    }
  
/* PX-MOBILE-OVERRIDE */
@media (max-width:980px){
  .play-grid{grid-template-columns:1fr; gap:10px; padding:10px}
  .panel{padding:10px}
  .game-title{display:none}
  .howto .row:last-child{display:none} /* hide controls-tip row */
  .gamebox{height:calc(100dvh - 56px - 24px); min-height:0}
}
/* PX-MOBILE-OVERRIDE-END */
</style>
</head>
<body>
  <div class="play-shell">
    <header class="play-topbar">
      <a class="exit-btn" href="../../index.html">‚úï EXIT</a>
      <div class="player-pill" title="Initials are set on the PIXEL-NET home page">
        <span class="dot"></span>
        <span class="muted">PLAYER</span>
        <strong id="playInitials">???</strong>
      </div>
    </header>

    <div class="play-grid">
      <aside class="panel">
        <h3>HOW TO PLAY</h3>
        <div class="howto">
          <div class="row"><div class="ico">üç∞</div><div><b>Eat Cake</b><br>Gain energy + short speed boost (+50 pts).</div></div>
          <div class="row"><div class="ico">üê≠</div><div><b>Catch the Mouse</b><br>Finish the level for a big bonus.</div></div>
          <div class="row"><div class="ico">üö´</div><div><b>Avoid Hazards</b><br>Dogs, mud slows you, sprinklers drain energy.</div></div>
        </div>
      </aside>

      <main class="panel game-panel">
        <div class="game-title">CAKED UP CATS</div>
        <div class="gamebox">
          <iframe id="gameFrame" src="./game.html" title="Caked Up Cats"></iframe>
        </div>
      </main>

      <aside class="panel">
        <h3>LEADERBOARD</h3>
        <div id="lbStatus" class="lb-status">Loading‚Ä¶</div>
        <div class="lb-grid">
          <ol id="lbLeft" class="lb-col"></ol>
          <ol id="lbRight" class="lb-col"></ol>
        </div>
      </aside>
    </div>
  </div>

  <script>
    (function(){
      const SLUG = "caked-up-cats";

      function norm(v){
        return String(v || "").toUpperCase().replace(/[^A-Z0-9]/g, "").slice(0,3) || "???";
      }

      const initials = norm(
        localStorage.getItem("px_player_initials") ||
        localStorage.getItem("px_initials") ||
        localStorage.getItem("pixelnet_initials") ||
        sessionStorage.getItem("playerInitials") ||
        "???"
      );

      document.getElementById("playInitials").textContent = initials;
      sessionStorage.setItem("playerInitials", initials);

      if (window.PixelNet && PixelNet.init) PixelNet.init();

      async function renderLeaderboard(){
        const status = document.getElementById("lbStatus");
        const L = document.getElementById("lbLeft");
        const R = document.getElementById("lbRight");
        L.innerHTML = ""; R.innerHTML = "";

        try{
          const rows = await PixelNet.getLeaderboard(SLUG);
          const arr = Array.isArray(rows) ? rows : (rows && rows.entries) ? rows.entries : [];
          const top = (arr || []).slice(0,10);
          if (!top.length){ status.textContent = "No scores yet."; return; }

          top.forEach((row,i)=>{
            const ini = norm(row.initials || row.name || row.user || "???");
            const sc = Number(row.score ?? row.points ?? row.value ?? 0) || 0;
            const li = document.createElement("li");
            li.className = "lb-item";
            li.innerHTML = `<span>${i+1}. ${ini}</span><span>${sc}</span>`;
            (i < 5 ? L : R).appendChild(li);
          });

          status.textContent = "";
        }catch(e){
          console.error("[CAKED-UP-CATS] leaderboard failed:", e);
          status.textContent = "Failed to load leaderboard (backend sleeping?).";
        }
      }

      renderLeaderboard();
      setInterval(renderLeaderboard, 6000);

      // Keep iframe focused for controls without breaking page scroll.
      const frame = document.getElementById("gameFrame");
      frame.addEventListener("load", () => {
        try{ frame.contentWindow.focus(); }catch(_){ }
      });
    })();
  </script>
</body>
</html>
