<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PIXEL-NET Arcade</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- PLAYER INITIALS (UI) -->
  <button id="px-player-badge" class="px-badge" type="button" aria-label="Player initials">???</button>

  <div id="px-initials-modal" class="px-modal" aria-hidden="true">
    <div class="px-modal__backdrop" data-close="1"></div>
    <div class="px-modal__panel" role="dialog" aria-modal="true" aria-labelledby="px-modal-title">
      <div class="px-modal__head">
        <h2 id="px-modal-title">Enter your initials</h2>
        <button class="px-iconbtn" type="button" data-close="1" aria-label="Close">×</button>
      </div>
      <p class="px-modal__sub">These are shown on leaderboards across games.</p>

      <div class="px-modal__row">
        <input id="px-initials-input" class="px-input" type="text" inputmode="text" autocomplete="off"
               autocapitalize="characters" spellcheck="false" maxlength="3" placeholder="TJW" />
        <button id="px-initials-save" class="px-btn" type="button">Save</button>
      </div>

      <div id="px-initials-error" class="px-modal__error" aria-live="polite"></div>
      <div class="px-modal__hint">1–3 letters or numbers. Click your initials (top-right) anytime to change.</div>
    </div>
  </div>

  <header class="site-header">
    <div class="brand">
      <div class="brand-mark">PX</div>
      <div class="brand-text">
        <div class="brand-title">PIXEL-NET</div>
        <div class="brand-subtitle">Online Arcade Network</div>
      </div>
    </div>

    <nav class="nav">
      <a class="nav-link" href="#featured-game">Featured</a>
      <a class="nav-link" href="#game-library">Library</a>
      <a class="nav-link" href="#top-dogs">Top Dogs</a>
    </nav>
  </header>

  <main class="wrap">

    <section id="featured-game" class="section">
      <div class="featured-card">
        <div class="featured-media">
          <img id="featuredThumb" src="assets/millipede_thumb.png" alt="Featured Game">
          <div class="featured-glow"></div>
          <div class="scanlines"></div>
        </div>

        <div class="featured-info">
          <span class="badge">Game of the Week</span>
          <h2 id="featuredTitle">Loading…</h2>
          <p id="featuredDesc">Featured game rotates weekly. Top the leaderboard and hold it.</p>
          <button id="featuredPlay" class="btn">Play Featured</button>
        </div>
      </div>
    </section>

    <section id="game-library" class="section">
      <div class="section-head">
        <h3>Arcade Floor</h3>
        <p class="muted">Pick a cabinet. Click to play.</p>
      </div>
      <div id="arcadeGrid" class="game-grid"></div>
    </section>

    <section id="top-dogs" class="section topdogs">
      <div class="section-head">
        <h3>Top Dogs</h3>
        <p class="muted">Players holding top scores the longest. Prestige only.</p>
      </div>

      <ul class="player-list">
        <li>
          <div class="player-name">TJW</div>
          <div class="player-details">
            <span class="pill">HOLDEM</span>
            <span class="score">4,109</span>
            <span class="held-time">Held 14 days</span>
          </div>
        </li>
        <li>
          <div class="player-name">CSK</div>
          <div class="player-details">
            <span class="pill">BLACKJACK</span>
            <span class="score">3,085</span>
            <span class="held-time">Held 9 days</span>
          </div>
        </li>
        <li>
          <div class="player-name">RZX</div>
          <div class="player-details">
            <span class="pill">NEON CHASE</span>
            <span class="score">987,450</span>
            <span class="held-time">Held 21 days</span>
          </div>
        </li>
      </ul>
    </section>

  </main>

  <footer class="footer wrap">
    <div class="muted">CREATED BY TYLER WAGGONER WITH THE USE OF AI</div>
    <div class="muted">PIXEL-NET • Static GitHub Pages • v4</div>
  </footer>

  <!-- INITIALS LOGIC (NO browser prompt) -->
  <script>
    (function () {
      const LS_KEY = "px_player_initials";
      const SS_KEY = "playerInitials";

      const badge = () => document.getElementById("px-player-badge");
      const modal = () => document.getElementById("px-initials-modal");
      const input = () => document.getElementById("px-initials-input");
      const err = () => document.getElementById("px-initials-error");

      function normalize(v) {
        return String(v || "")
          .toUpperCase()
          .replace(/[^A-Z0-9]/g, "")
          .slice(0, 3);
      }

      function getInitials() {
        return localStorage.getItem(LS_KEY) || sessionStorage.getItem(SS_KEY) || "";
      }

      function setInitials(v) {
        localStorage.setItem(LS_KEY, v);
        sessionStorage.setItem(SS_KEY, v);
      }

      function setError(msg) {
        if (err()) err().textContent = msg || "";
      }

      function renderBadge() {
        const b = badge();
        if (!b) return;
        const v = getInitials();
        b.textContent = v || "???";
      }

      function openModal(force) {
        const m = modal();
        if (!m) return;
        m.classList.add("is-open");
        m.setAttribute("aria-hidden", "false");
        const v = force ? getInitials() : (getInitials() || "");
        if (input()) {
          input().value = v;
          setTimeout(() => { input().focus(); input().select(); }, 0);
        }
        setError("");
      }

      function closeModal() {
        const m = modal();
        if (!m) return;
        m.classList.remove("is-open");
        m.setAttribute("aria-hidden", "true");
        setError("");
        renderBadge();
      }

      function save() {
        const v = normalize(input() ? input().value : "");
        if (!v) {
          setError("Please enter 1–3 letters or numbers.");
          if (input()) input().focus();
          return;
        }
        setInitials(v);
        closeModal();
      }

      window.addEventListener("DOMContentLoaded", () => {
        renderBadge();

        // Show modal on first visit (no initials saved yet)
        if (!getInitials()) openModal(false);

        // Click badge to edit
        if (badge()) badge().addEventListener("click", () => openModal(true));

        // Save button / Enter key
        const btn = document.getElementById("px-initials-save");
        if (btn) btn.addEventListener("click", save);

        if (input()) {
          input().addEventListener("keydown", (e) => {
            if (e.key === "Enter") save();
            if (e.key === "Escape") closeModal();
          });
          input().addEventListener("input", () => {
            const cur = input().selectionStart;
            const before = input().value;
            const after = normalize(before);
            if (before !== after) {
              input().value = after;
              input().setSelectionRange(Math.min(cur, after.length), Math.min(cur, after.length));
            }
          });
        }

        // Close handlers
        document.querySelectorAll('[data-close="1"]').forEach((el) => {
          el.addEventListener("click", () => closeModal());
        });
      });
    })();
  </script>

  <script>
    // Normalize old/new games.json formats into one consistent shape.
    function normalizeGame(g) {
      const name = g.name ?? g.title ?? g.game ?? g.id ?? "UNTITLED";
      const thumb = g.thumb ?? g.image ?? g.thumbnail ?? "";
      const type = (g.type ?? "").toLowerCase();
      const path = g.path ?? g.url ?? g.href ?? "";
      const script = g.script ?? g.js ?? "";
      const inferredType = type || (path && path.toLowerCase().endsWith(".html") ? "iframe" : "script");
      return { name, thumb, type: inferredType, path, script };
    }

    async function loadGames() {
      try {
        const res = await fetch("./games.json", { cache: "no-store" });
        if (!res.ok) throw new Error("games.json fetch failed");

        const raw = await res.json();
        const games = raw.map(normalizeGame);

        const featured = games[0];
        if (featured) {
          document.getElementById("featuredThumb").src = featured.thumb || "assets/millipede_thumb.png";
          document.getElementById("featuredTitle").textContent = featured.name;
          document.getElementById("featuredPlay").onclick = () => {
            if (!featured.path) return alert("Missing path for featured game.");
            window.location.href = featured.path;
          };
        }

        const grid = document.getElementById("arcadeGrid");
        grid.innerHTML = "";

        games.forEach(game => {
          const card = document.createElement("div");
          card.className = "game-card";

          const img = document.createElement("img");
          img.src = game.thumb || "assets/millipede_thumb.png";
          img.alt = game.name;

          const title = document.createElement("h4");
          title.textContent = game.name;

          card.appendChild(img);
          card.appendChild(title);

          card.onclick = () => {
            if (game.type === "iframe") {
              if (!game.path) return alert("Missing iframe path for: " + game.name);
              window.location.href = game.path;
              return;
            }
            if (!game.script) return alert("Missing script for: " + game.name);
            const s = document.createElement("script");
            s.src = game.script;
            document.body.appendChild(s);
          };

          grid.appendChild(card);
        });

      } catch (e) {
        console.error(e);
        alert("Loader error. Open DevTools Console for details.");
      }
    }

    loadGames();
  </script>

</body>
</html>
